<tool id="hubArchiveCreator" name="Hub Archive Creator" version="1.6.0">
    <description>
        This Galaxy tool permits to prepare your files to be ready for
        Assembly Hub visualization.
    </description>

    <requirements>
        <requirement type="package" version="312">ucsc_tools</requirement>
        <requirement type="package" version="0.0.1">gff3ToGenePred</requirement>
        <requirement type="package" version="0.0.1">genePredToBed</requirement>
    </requirements>

    <stdio>
        <regex match="^pass1"
               source="stderr"
               level="log"
               description="bedToBigBed" />
        <!-- TODO: Add the case pass1 and 0 chroms -->
        <!-- TODO: Add the case pass2 and 0 records or 0 fields -->
    </stdio>

    <!-- Idea: python \ -augustus [parameters] \ -trfBig [parameters] -->
    <command><![CDATA[
        mkdir -p $output.files_path &&
        python $__tool_directory__/hubArchiveCreator.py
        #if $toolChoice.tool_select == "augustus"
            -g $GFF3_Track
        #if $toolChoice.tool_select == "trfBig"
            -t $fasta_trfBig
        #end if
        -f $Fasta_File -d $__tool_directory__ -e $output.files_path -o $output;
    ]]></command>

    <inputs>
        <param
            format="fasta"
            name="Fasta_File"
            type="data"
            label="Reference genome"
        />
        <conditional name="toolChoice">
            <param name="tool_select" type="select" label="Tool">
                <option value="augustus" selected="true">Augustus</option>
                <option value="trfbig">TrfBig</option>
            </param>

            <when value="augustus">
                <param
                    format="gff3"
                    name="GFF3_Track"
                    type="data"
                    label="GFF3 track to display"
                />
            </when>
            <when value="trfbig">
                <param
                    format="fasta"
                    name="fasta_trfBig"
                    type="data"
                    label="Genome to mask"
                />
            </when>
        </conditional>
    </inputs>

    <outputs>
        <data format="huba" name="output" />
    </outputs>

    <tests>
        <test>
            <param name="GFF3_Track" value="augustusDbia3.gff3"/>
            <param name="Fasta_File" value="dbia3.fa"/>
            <output name="output">
                <assert_contents>
                    <has_text text="myHub" />
                </assert_contents>
            </output>
        </test>
    </tests>

    <help>
        This Galaxy tool permits to prepare your files to be ready for
        Assembly Hub visualization.
    </help>
</tool>
